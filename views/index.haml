!!!
%html
  %head
    %title Wyld Wiki Warble
    %link{:rel => 'stylesheet', :href => 'style.css', :type => 'text/css'}
    %script{:src => 'jquery.js', :type => 'text/javascript'}
    %script{:type => 'text/javascript'}
      :plain
        var words = {'Warble': '[Knowledge] in 140 characters or less'};

        function check(definition) {
          return false;
        }

        function recount(e) {
          var length = document.getElementById('data').value.length;
          $('#remaining')
            .html(length)
            .toggleClass('warning', 130 < length && length <= 140)
            .toggleClass('error', 140 < length);
        }

        function parse_links(definition) {
          //Add "a" tag
          return jQuery.trim(definition);
        }

        function load_word(word, definition) {
          var new_concept = $('.sample').clone()
            .removeClass('sample')
            .insertAfter('.sample');
          new_concept.children('dt').text(word);
          new_concept.children('dd').text(parse_links(definition));
        }

        function add_definition(e) {
          if(e.keyCode == 13) {
            var text = document.getElementById('data').value;
            var i = text.search(':');
            if(i > 0 && text.length - i > 1) {
              var word = text.substr(0, i);
              var definition = text.substr( i+1 );

              load_word(word, definition);
            
              //TODO Send to server via AJAJ

              //TODO Update if a visible definition
              //console.log('w '+word+' d '+definition);
            }
            e.preventDefault();
          }
        }

        $(document).ready(function() {
          $('#data')
            .keyup(recount)
            .keydown(add_definition)
            .focus();
          recount();

          for(var w in words) {
            load_word(w, words[w]);
          }
        });
  %body
    .top
    %h1 Warble (11)
    #content
      .left
      .main
        %div
          %div
            (
            %span#remaining.countdown 29
            )
        %textarea#data Warble's Motto: Spread wisdom
        %dl.sample
          %hr
          %dt 
          %dd
        #history
      .right
    .bottom
      %p Knowledge Management meets Wiki + Twitter. (47)
